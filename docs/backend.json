{
  "entities": {
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a property registered in the Bhumi system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Property entity."
        },
        "ownerWalletAddress": {
          "type": "string",
          "description": "Ethereum wallet address of the property owner."
        },
        "propertyDocumentsCID": {
          "type": "string",
          "description": "IPFS CID (Content Identifier) for the property documents."
        },
        "propertyDocumentsSHA256Hash": {
          "type": "string",
          "description": "SHA-256 hash of the property documents for integrity verification."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the property was registered.",
          "format": "date-time"
        },
        "propertyName": {
          "type": "string",
          "description": "Name of the property."
        },
        "propertyDescription": {
          "type": "string",
          "description": "Detailed description of the property."
        },
        "propertyLocation": {
          "type": "string",
          "description": "Location of the property."
        }
      },
      "required": [
        "id",
        "ownerWalletAddress",
        "propertyDocumentsCID",
        "propertyDocumentsSHA256Hash",
        "registrationDate",
        "propertyName",
        "propertyDescription",
        "propertyLocation"
      ]
    },
    "PropertyTransfer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PropertyTransfer",
      "type": "object",
      "description": "Represents a property transfer request.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PropertyTransfer entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to the Property being transferred. (Relationship: Property 1:N PropertyTransfer)"
        },
        "sellerWalletAddress": {
          "type": "string",
          "description": "Ethereum wallet address of the seller (current owner)."
        },
        "buyerWalletAddress": {
          "type": "string",
          "description": "Ethereum wallet address of the buyer (new owner)."
        },
        "transferInitiationDate": {
          "type": "string",
          "description": "Date and time when the transfer was initiated.",
          "format": "date-time"
        },
        "transferApprovalDate": {
          "type": "string",
          "description": "Date and time when the transfer was approved by the registrar. Null if pending.",
          "format": "date-time"
        },
        "transferStatus": {
          "type": "string",
          "description": "Status of the transfer (e.g., 'pending', 'approved', 'rejected')."
        }
      },
      "required": [
        "id",
        "propertyId",
        "sellerWalletAddress",
        "buyerWalletAddress",
        "transferInitiationDate",
        "transferStatus"
      ]
    },
    "Registrar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Registrar",
      "type": "object",
      "description": "Represents a registrar user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Registrar entity."
        },
        "walletAddress": {
          "type": "string",
          "description": "Ethereum wallet address of the registrar."
        },
        "name": {
          "type": "string",
          "description": "Name of the registrar."
        },
        "email": {
          "type": "string",
          "description": "Email address of the registrar.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "walletAddress",
        "name",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Stores property details. The 'ownerWalletAddress' field is denormalized to enable authorization independence. This is the root collection from which properties are listed and accessed.",
          "params": [
            {
              "name": "propertyId",
              "description": "Unique identifier for the property document."
            }
          ]
        }
      },
      {
        "path": "/propertyTransfers/{propertyTransferId}",
        "definition": {
          "entityName": "PropertyTransfer",
          "schema": {
            "$ref": "#/backend/entities/PropertyTransfer"
          },
          "description": "Stores property transfer requests. Includes denormalized 'sellerWalletAddress' and 'buyerWalletAddress' fields for authorization independence, and 'propertyId' for efficient queries related to a specific property.",
          "params": [
            {
              "name": "propertyTransferId",
              "description": "Unique identifier for the property transfer request."
            }
          ]
        }
      },
      {
        "path": "/registrars/{registrarId}",
        "definition": {
          "entityName": "Registrar",
          "schema": {
            "$ref": "#/backend/entities/Registrar"
          },
          "description": "Stores registrar information. Document existence is used for role-based access control. No denormalization is needed here, as the existence of a document serves as the role assignment.",
          "params": [
            {
              "name": "registrarId",
              "description": "Unique identifier for the registrar document, typically matching the user's UID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Bhumi application's core features, focusing on property registration, transfer, and registrar management. It prioritizes authorization independence and easy querying. Each collection is designed for a homogeneous security posture.\n\n*   `/properties`: Stores property details. Access control relies on the `ownerWalletAddress` field within each document, enabling direct authorization rules without needing to `get()` data from other collections.\n*   `/propertyTransfers`: Stores property transfer requests. Includes denormalized `sellerWalletAddress` and `buyerWalletAddress` fields for authorization. Filtering is done via queries based on `propertyId` and `transferStatus`.\n*   `/registrars`: Stores registrar information. This collection uses document existence for role-based access control. The mere presence of a document for a given `uid` in this collection grants registrar privileges.\n\nThis structure achieves Authorization Independence by denormalizing authorization-relevant data directly into the documents where it's needed, avoiding expensive and brittle `get()` calls in security rules. For example, the `propertyTransfers` collection denormalizes `sellerWalletAddress` and `buyerWalletAddress`, which allows security rules to validate transfer requests without needing to look up the associated property or user documents. This ensures atomic operations and avoids race conditions.\n\nQAPs (Rules are not Filters) are supported through structural segregation. Publicly accessible data (e.g., property search) resides in the `/properties` collection, which can be queried securely based on the `ownerWalletAddress` and validated client-side, ensuring rules act as gatekeepers rather than filters. The separation of registrar data into `/registrars` enables straightforward role-based access control using document existence, and simplifies queries for registrar-related operations.\n\nThe design also uses path-based ownership for property transfer requests within a property, enhancing security and query performance."
  }
}