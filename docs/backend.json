{
  "entities": {
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a property registered in the Bhumi system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Property entity."
        },
        "registrarAddress": {
          "type": "string",
          "description": "Ethereum address of the registrar who registered the property."
        },
        "ownerAddress": {
          "type": "string",
          "description": "Ethereum address of the current property owner."
        },
        "ipfsCID": {
          "type": "string",
          "description": "IPFS CID (Content Identifier) of the property documents."
        },
        "sha256Hash": {
          "type": "string",
          "description": "SHA-256 hash of the property document for integrity verification."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the property was registered.",
          "format": "date-time"
        },
        "propertyDetails": {
          "type": "string",
          "description": "Additional details about the property (e.g., address, size).  This can be a serialized JSON string, or a simple text description depending on desired complexity."
        }
      },
      "required": [
        "id",
        "registrarAddress",
        "ownerAddress",
        "ipfsCID",
        "sha256Hash",
        "registrationDate",
        "propertyDetails"
      ]
    },
    "TransferRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransferRequest",
      "type": "object",
      "description": "Represents a request to transfer property ownership.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransferRequest entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property being transferred. (Relationship: Property 1:N TransferRequest)"
        },
        "sellerAddress": {
          "type": "string",
          "description": "Ethereum address of the seller initiating the transfer."
        },
        "buyerAddress": {
          "type": "string",
          "description": "Ethereum address of the buyer receiving the property."
        },
        "requestDate": {
          "type": "string",
          "description": "Date and time when the transfer request was initiated.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the transfer request (e.g., pending, approved, rejected)."
        }
      },
      "required": [
        "id",
        "propertyId",
        "sellerAddress",
        "buyerAddress",
        "requestDate",
        "status"
      ]
    },
    "TransferEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransferEvent",
      "type": "object",
      "description": "Represents a historical record of a property transfer event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransferEvent entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property that was transferred. (Relationship: Property 1:N TransferEvent)"
        },
        "transferRequestId": {
          "type": "string",
          "description": "Reference to TransferRequest that triggered this event. (Relationship: TransferRequest 1:1 TransferEvent)"
        },
        "sellerAddress": {
          "type": "string",
          "description": "Ethereum address of the seller in the transfer."
        },
        "buyerAddress": {
          "type": "string",
          "description": "Ethereum address of the buyer in the transfer."
        },
        "eventDate": {
          "type": "string",
          "description": "Date and time when the transfer event occurred.",
          "format": "date-time"
        },
        "registrarAddress": {
          "type": "string",
          "description": "Ethereum address of the registrar who approved the transfer."
        }
      },
      "required": [
        "id",
        "propertyId",
        "transferRequestId",
        "sellerAddress",
        "buyerAddress",
        "eventDate",
        "registrarAddress"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Stores property details. Includes denormalized 'ownerAddress' for authorization independence.",
          "params": [
            {
              "name": "propertyId",
              "description": "Unique identifier for the property document."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}/transferRequests/{transferRequestId}",
        "definition": {
          "entityName": "TransferRequest",
          "schema": {
            "$ref": "#/backend/entities/TransferRequest"
          },
          "description": "Stores transfer requests associated with a property.",
          "params": [
            {
              "name": "propertyId",
              "description": "Unique identifier for the parent property document."
            },
            {
              "name": "transferRequestId",
              "description": "Unique identifier for the transfer request document."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}/transferEvents/{transferEventId}",
        "definition": {
          "entityName": "TransferEvent",
          "schema": {
            "$ref": "#/backend/entities/TransferEvent"
          },
          "description": "Stores historical transfer events associated with a property. Includes 'propertyId', 'sellerAddress', 'buyerAddress', and 'registrarAddress'.",
          "params": [
            {
              "name": "propertyId",
              "description": "Unique identifier for the parent property document."
            },
            {
              "name": "transferEventId",
              "description": "Unique identifier for the transfer event document."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Bhumi application's core features, focusing on property registration, transfer requests, and transfer events. The design prioritizes authorization independence to ensure secure and scalable operations.  \n\nTo achieve Authorization Independence, the `ownerAddress` is included within each Property document. For `TransferRequest` objects, the `propertyId` field is used to indicate the parent Property document. Authorization checks within security rules can then use `request.auth.uid` against these denormalized fields to grant or restrict access to a specific document. Additionally, the `TransferEvent` also includes the `propertyId`, `sellerAddress`, `buyerAddress` and `registrarAddress`, to track the transfer even if the original `TransferRequest` document is deleted or modified.\n\nThis data structure supports QAPs (Rules are not Filters) by segregating data based on access requirements. All documents within a collection share the same security posture, simplifying rules and preventing unintended data exposure. The structure supports ownership and integrity through the use of specific fields and clear naming conventions."
  }
}